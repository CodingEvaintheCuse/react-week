<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>ToDo</title>
    <!-- Import Bootstrap CSS -->
    <link
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <!-- Import CSS required for the datepicker -->
    <link
      rel="stylesheet"
      href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />
  </head>
  <body>
    <div class="container">
      <!-- onsubmit ties the clicking the submit button to the JS at the end of the file -->
      <!-- We use a bunch of bootstrap classes here (card, row, col-md, form-group, etc) to
      make our form look prettier -->
      <form class="card" style="margin-top: 20px;" onsubmit="newTask(event)">
        <div class="card-body">
          <div class="row">
            <div class="col-md">
              <div class="form-group">
                <label for="name">Name</label>
                <input class="form-control" id="name" />
              </div>
            </div>
            <div class="col-md">
              <div class="form-group">
                <label for="task">Task</label>
                <input class="form-control" id="task" />
              </div>
            </div>
            <div class="col-md">
              <div class="form-group">
                <label for="dueDate">Due Date</label>
                <input class="form-control" id="dueDate" type="text" />
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col text-center">
              <button type="submit" class="btn btn-primary">Submit</button>
            </div>
          </div>
        </div>
      </form>

      <div class="row" style="margin-top: 20px;">
        <div class="col">
          <table class="table">
            <thead>
              <tr>
                <th>Task</th>
                <th>Creator</th>
                <th>Due Date</th>
                <th>Completion Time</th>
                <th>Edit</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Finish the ToDo App</td>
                <td>CiC Students (not Max)</td>
                <td>6/25/19</td>
                <td></td>
                <td>
                  <button type="button" class="btn btn-primary">Edit</button>
                </td>
                <td>
                  <button type="button" class="btn btn-danger">Delete</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </body>
  <!-- Import jQuery, Bootstrap, and datepicker JS from CDNs -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script
    src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"
  ></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
    $(() => {
      // tell jQuery to wait until it's loaded, then attach the datepicker library to the input
      $("#dueDate").datepicker();
    });

    function newTask(evt) {
      //prevent the browser page from refreshing
      evt.preventDefault();

      //get the values from the input fields above
      const name = $("#name").val();
      const task = $("#task").val();
      const dueDate = $("#dueDate").val();

      //make a fetch POST request to our backend
      fetch("http://127.0.0.1:8080/task", {
        method: "POST",
        headers: {
          "Content-Type": "application/json" //tell the server we're sending it JSON so it knows to parse it out
        },
        //send the fields with the names the server is expecting
        body: JSON.stringify({ name: task, dueTime: dueDate, userName: name })
      })
        .then(rawJSON => {
          //parse out the returning JSON string
          return rawJSON.json();
        })
        .then(data => {
          //we don't use data here, but add a console log to know that it worked
          console.log("fetch worked");
        });
    }

    //similar to above, but just console.log out the returning data
    fetch("http://127.0.0.1:8080/task", {
      method: "GET"
    })
      .then(rawJSON => {
        return rawJSON.json();
      })
      .then(data => {
        console.log(data);
      });
  </script>
</html>
